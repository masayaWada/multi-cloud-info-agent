# Multi-Cloud Info Agent セットアップガイド

## 概要

このガイドでは、Multi-Cloud Info Agent の環境構築から起動までの手順を説明します。

## 前提条件

- Python 3.8 以上
- Node.js 16 以上
- npm または yarn
- AWS CLI (AWS リソースアクセス用)
- Azure CLI (Azure リソースアクセス用)

## 1. リポジトリのクローン

```bash
git clone <repository-url>
cd multi-cloud-info-agent
```

## 2. バックエンドのセットアップ

### 2.1 Python 仮想環境の作成

```bash
cd backend
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate
```

### 2.2 依存関係のインストール

```bash
pip install -r requirements.txt
```

### 2.3 環境変数の設定

`.env` ファイルを作成し、以下の環境変数を設定します：

```bash
cp .env.example .env
```

`.env` ファイルの内容：

```env
# Flask設定
FLASK_HOST=0.0.0.0
FLASK_PORT=5000
FLASK_DEBUG=True
SECRET_KEY=your-secret-key-here

# OpenAI設定
OPENAI_API_KEY=your-openai-api-key

# AWS設定
AWS_ACCESS_KEY_ID=your-aws-access-key
AWS_SECRET_ACCESS_KEY=your-aws-secret-key
AWS_DEFAULT_REGION=us-east-1

# Azure設定
AZURE_CLIENT_ID=your-azure-client-id
AZURE_CLIENT_SECRET=your-azure-client-secret
AZURE_TENANT_ID=your-azure-tenant-id
AZURE_SUBSCRIPTION_ID=your-azure-subscription-id

# ログ設定
LOG_LEVEL=INFO
LOG_FILE=logs/app.log
```

### 2.4 バックエンドの起動

```bash
python run.py
```

バックエンドが `http://localhost:5000` で起動します。

## 3. フロントエンドのセットアップ

### 3.1 依存関係のインストール

```bash
cd ../frontend
npm install
```

### 3.2 フロントエンドの起動

```bash
npm start
```

フロントエンドが `http://localhost:3000` で起動します。

## 4. 認証情報の設定

### 4.1 AWS 認証情報

AWS CLI を使用して認証情報を設定：

```bash
aws configure
```

または、環境変数で直接設定：

```bash
export AWS_ACCESS_KEY_ID=your-access-key
export AWS_SECRET_ACCESS_KEY=your-secret-key
export AWS_DEFAULT_REGION=us-east-1
```

### 4.2 Azure 認証情報

Azure CLI を使用してログイン：

```bash
az login
```

または、サービスプリンシパルを使用：

```bash
az login --service-principal \
  --username $AZURE_CLIENT_ID \
  --password $AZURE_CLIENT_SECRET \
  --tenant $AZURE_TENANT_ID
```

## 5. 動作確認

### 5.1 ヘルスチェック

```bash
curl http://localhost:5000/health
```

### 5.2 フロントエンドアクセス

ブラウザで `http://localhost:3000` にアクセスし、チャットインターフェースが表示されることを確認します。

### 5.3 テストメッセージ

チャットインターフェースで以下のようなメッセージを送信してテストします：

- "EC2インスタンス一覧を教えて"
- "Azure VM の状態を確認して"
- "最近のエラーログを見せて"

## 6. トラブルシューティング

### 6.1 バックエンドが起動しない

- Python のバージョンを確認：`python --version`
- 仮想環境がアクティブになっているか確認
- 依存関係が正しくインストールされているか確認：`pip list`

### 6.2 フロントエンドが起動しない

- Node.js のバージョンを確認：`node --version`
- 依存関係が正しくインストールされているか確認：`npm list`
- ポート3000が使用されていないか確認

### 6.3 AWS リソースが取得できない

- AWS 認証情報が正しく設定されているか確認
- IAM ポリシーで読み取り権限が付与されているか確認
- リージョンが正しく設定されているか確認

### 6.4 Azure リソースが取得できない

- Azure 認証情報が正しく設定されているか確認
- サブスクリプション ID が正しいか確認
- 適切な権限が付与されているか確認

## 7. 開発環境での作業

### 7.1 コードの品質チェック

```bash
# Python コードのフォーマット
black backend/

# Python コードのリント
flake8 backend/

# JavaScript コードのリント
cd frontend
npm run lint
```

### 7.2 テストの実行

```bash
# バックエンドのテスト
cd backend
pytest

# フロントエンドのテスト
cd frontend
npm test
```

## 8. 本番環境へのデプロイ

### 8.1 環境変数の設定

本番環境では以下の点に注意してください：

- `FLASK_DEBUG=False` に設定
- 強力な `SECRET_KEY` を設定
- 適切なログレベルを設定
- HTTPS を使用

### 8.2 セキュリティ設定

- ファイアウォールの設定
- 認証機能の実装
- API レート制限の実装
- ログの監視とアラート設定

## 9. サポート

問題が発生した場合は、以下の情報を含めて報告してください：

- エラーメッセージ
- 実行環境（OS、Python バージョン、Node.js バージョン）
- 設定ファイルの内容（機密情報を除く）
- 実行したコマンド
