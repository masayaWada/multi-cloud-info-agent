# Multi-Cloud Info Agent アーキテクチャ設計

## 概要

Multi-Cloud Info Agent は、AWS と Azure のリソース情報を自然言語で取得・閲覧するための Web アプリケーションです。読み取り専用の操作に限定し、安全性と使いやすさを重視した設計となっています。

## システム構成

```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   Frontend      │    │    Backend      │    │  Cloud APIs     │
│   (React)       │◄──►│   (Flask)       │◄──►│  (AWS/Azure)    │
│                 │    │                 │    │                 │
│ - Chat UI       │    │ - REST API      │    │ - EC2, S3, RDS  │
│ - Avatar        │    │ - LLM Service   │    │ - VM, Storage   │
│ - Real-time     │    │ - MCP Service   │    │ - CloudWatch    │
└─────────────────┘    └─────────────────┘    └─────────────────┘
```

## コンポーネント詳細

### 1. フロントエンド (React)

#### 主要コンポーネント

- **App.js**: メインアプリケーションコンポーネント
- **ChatInterface.js**: チャット機能のUI
- **Avatar.js**: アバター表示とアニメーション
- **Header.js**: アプリケーションヘッダー

#### 技術スタック

- **React 18**: UI フレームワーク
- **Styled Components**: CSS-in-JS スタイリング
- **Framer Motion**: アニメーション
- **React Markdown**: マークダウン表示
- **Axios**: HTTP クライアント

#### 特徴

- レスポンシブデザイン
- リアルタイムチャット体験
- アバターとの連携
- タイプライター風の表示
- ダークテーマ

### 2. バックエンド (Flask)

#### アーキテクチャパターン

- **MVC パターン**: Model-View-Controller の分離
- **サービス層**: ビジネスロジックの分離
- **依存性注入**: テスタビリティの向上

#### 主要モジュール

```
backend/
├── app/
│   ├── __init__.py          # アプリケーション初期化
│   ├── routes/              # ルーティング
│   │   ├── main.py         # 基本ルート
│   │   └── api.py          # API エンドポイント
│   ├── services/           # ビジネスロジック
│   │   ├── chat_service.py # チャット処理
│   │   ├── llm_service.py  # LLM 連携
│   │   └── mcp_service.py  # クラウドAPI連携
│   ├── models/             # データモデル
│   │   ├── message.py      # メッセージモデル
│   │   └── resource.py     # リソースモデル
│   └── utils/              # ユーティリティ
│       └── logger.py       # ログ機能
└── run.py                  # エントリーポイント
```

#### 技術スタック

- **Flask**: Web フレームワーク
- **Flask-CORS**: CORS 対応
- **OpenAI**: LLM 連携
- **Boto3**: AWS SDK
- **Azure SDK**: Azure 連携
- **Pydantic**: データバリデーション

### 3. データフロー

#### チャット処理フロー

```
1. ユーザー入力
   ↓
2. フロントエンド → バックエンド API
   ↓
3. ChatService でメッセージ解析
   ↓
4. LLMService で意図解析
   ↓
5. MCPService でクラウドAPI呼び出し
   ↓
6. レスポンス生成・整形
   ↓
7. フロントエンドで表示
```

#### エラーハンドリング

- **グローバル例外ハンドラー**: 未処理例外のキャッチ
- **ログ記録**: 詳細なエラー情報の記録
- **ユーザーフレンドリーなエラーメッセージ**: 技術的詳細を隠蔽

## セキュリティ設計

### 1. 認証・認可

- **最小権限の原則**: 読み取り専用の権限のみ
- **IAM ロール**: AWS リソースへのアクセス
- **Entra ID**: Azure リソースへのアクセス
- **環境変数**: 機密情報の管理

### 2. データ保護

- **読み取り専用**: 更新操作の完全禁止
- **ログ記録**: 全操作の監査ログ
- **データ暗号化**: 転送時・保存時の暗号化

### 3. ネットワークセキュリティ

- **HTTPS**: 通信の暗号化
- **CORS 設定**: 適切なオリジン制限
- **ファイアウォール**: 不要なポートのブロック

## パフォーマンス設計

### 1. フロントエンド最適化

- **コンポーネント分割**: 再利用性とパフォーマンス
- **メモ化**: 不要な再レンダリングの防止
- **遅延読み込み**: 必要時のみのリソース読み込み

### 2. バックエンド最適化

- **非同期処理**: I/O 待機時間の削減
- **キャッシュ**: 頻繁にアクセスされるデータのキャッシュ
- **接続プール**: データベース接続の効率化

### 3. API 最適化

- **ページネーション**: 大量データの分割取得
- **フィルタリング**: 必要なデータのみ取得
- **レスポンス圧縮**: 転送データ量の削減

## 監視・ログ設計

### 1. ログレベル

- **DEBUG**: 開発時の詳細情報
- **INFO**: 一般的な操作情報
- **WARNING**: 注意が必要な状況
- **ERROR**: エラー情報
- **CRITICAL**: システム停止レベルのエラー

### 2. ログ出力先

- **コンソール**: 開発環境
- **ファイル**: 本番環境
- **外部サービス**: 将来的な拡張

### 3. メトリクス

- **レスポンス時間**: API の応答速度
- **エラー率**: 失敗率の監視
- **リソース使用量**: CPU、メモリ使用量

## 拡張性設計

### 1. 水平スケーリング

- **ステートレス設計**: セッション情報の外部化
- **ロードバランサー**: 複数インスタンスの分散
- **コンテナ化**: Docker によるデプロイ

### 2. 機能拡張

- **プラグインアーキテクチャ**: 新機能の追加
- **設定ファイル**: 外部設定による柔軟性
- **API バージョニング**: 後方互換性の維持

### 3. データベース拡張

- **ORM 抽象化**: データベースの変更対応
- **マイグレーション**: スキーマ変更の管理
- **レプリケーション**: 読み取り性能の向上

## 運用設計

### 1. デプロイメント

- **CI/CD パイプライン**: 自動化されたデプロイ
- **ブルーグリーンデプロイ**: ダウンタイムの最小化
- **ロールバック**: 問題発生時の迅速な復旧

### 2. バックアップ・復旧

- **設定ファイル**: バージョン管理
- **ログファイル**: 定期的なアーカイブ
- **災害復旧**: システム全体の復旧手順

### 3. メンテナンス

- **定期メンテナンス**: システムの健全性確認
- **セキュリティ更新**: 脆弱性の修正
- **パフォーマンスチューニング**: 継続的な改善

## 今後の拡張予定

### 1. 機能拡張

- **認証機能**: ユーザー管理とアクセス制御
- **ダッシュボード**: リソース状況の可視化
- **アラート機能**: 異常検知と通知

### 2. 技術拡張

- **GraphQL**: より柔軟なAPI
- **WebSocket**: リアルタイム通信
- **マイクロサービス**: サービス分割

### 3. クラウド対応拡張

- **Google Cloud**: GCP リソースの対応
- **マルチリージョン**: 複数リージョンの対応
- **ハイブリッドクラウド**: オンプレミスとの連携
